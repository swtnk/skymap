import{r as e,j as t}from"./react-vendor-OEMN43JN.js";import{L as o}from"./map-vendor-scx2wcTa.js";import{y as r,z as n,F as a,J as l,B as s,K as i}from"./ui-vendor-Bo0zONUq.js";function c({open:c,initial:d,onSelect:m,onClose:u}){const p=e.useRef(null),x=e.useRef(null),g=e.useRef(null),[h,f]=e.useState(d??{lat:0,lng:0}),[v,j]=e.useState(""),[y,b]=e.useState(!1),k=async(e,t)=>{b(!0);try{const o=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&zoom=10&addressdetails=1`),r=await o.json();r.display_name?j(r.display_name):j(`${e.toFixed(4)}°, ${t.toFixed(4)}°`)}catch(o){j(`${e.toFixed(4)}°, ${t.toFixed(4)}°`)}finally{b(!1)}};e.useEffect(()=>{if(!c){if(x.current){try{x.current.remove()}catch(t){}x.current=null,g.current=null}return void j("")}const e=setTimeout(()=>{if(p.current)if(x.current)x.current.invalidateSize();else try{const e=o.map(p.current,{center:[(null==d?void 0:d.lat)||0,(null==d?void 0:d.lng)||0],zoom:(null==d?void 0:d.lat)||(null==d?void 0:d.lng)?5:2,zoomControl:!0,scrollWheelZoom:!0,doubleClickZoom:!0,touchZoom:!0,boxZoom:!0,keyboard:!0,dragging:!0});x.current=e;const t=o.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"© OpenStreetMap contributors"}),r=o.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri"}),n=o.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17,attribution:"© OpenTopoMap contributors"});t.addTo(e);const a={Streets:t,Satellite:r,Terrain:n};o.control.layers(a).addTo(e),o.control.scale({imperial:!0,metric:!0,position:"bottomleft"}).addTo(e),setTimeout(()=>{x.current&&x.current.invalidateSize()},200),e.on("click",t=>{const{lat:r,lng:n}=t.latlng;f({lat:r,lng:n}),k(r,n),g.current?g.current.setLatLng([r,n]):g.current=o.marker([r,n]).addTo(e)}),d&&(g.current=o.marker([d.lat,d.lng]).addTo(e),k(d.lat,d.lng))}catch(e){}},150);return()=>{clearTimeout(e)}},[c]);return t.jsx(r,{open:c,onOpenChange:e=>!e&&u(),children:t.jsxs(n,{className:"max-w-4xl w-[90vw] h-[80vh] flex flex-col p-0 gap-0",children:[t.jsx(a,{className:"p-4 pb-2 border-b",children:t.jsx(l,{children:"Pick Location On Map"})}),t.jsxs("div",{className:"flex-1 flex flex-col p-4 overflow-hidden",style:{minHeight:0},children:[t.jsx("div",{ref:p,className:"rounded-md overflow-hidden border bg-gray-900",style:{height:"calc(80vh - 180px)",minHeight:"400px",width:"100%"}}),t.jsxs("div",{className:"mt-3 space-y-2",children:[y&&t.jsx("div",{className:"text-sm text-muted-foreground italic",children:"Loading location info..."}),!y&&v&&t.jsxs("div",{className:"p-3 rounded-md bg-muted/50 border",children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Selected Location:"}),t.jsx("div",{className:"text-sm font-medium",children:v}),t.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[h.lat.toFixed(6),"°, ",h.lng.toFixed(6),"°"]})]}),!y&&!v&&t.jsx("div",{className:"text-sm text-muted-foreground",children:"Click on the map to place the marker, then press Select."})]}),t.jsxs("div",{className:"flex gap-2 justify-between mt-4",children:[t.jsxs(s,{variant:"outline",onClick:()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{const t=e.coords.latitude,r=e.coords.longitude;f({lat:t,lng:r}),k(t,r),x.current&&(x.current.setView([t,r],10),g.current?g.current.setLatLng([t,r]):g.current=o.marker([t,r]).addTo(x.current))},e=>{alert("Unable to retrieve your location. Please ensure location permissions are enabled.")}):alert("Geolocation is not supported by your browser")},className:"gap-2",children:[t.jsx(i,{className:"h-4 w-4"}),"Use Current Location"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(s,{variant:"outline",onClick:u,children:"Cancel"}),t.jsx(s,{onClick:()=>{m(h.lat,h.lng,v||`${h.lat.toFixed(4)}°, ${h.lng.toFixed(4)}°`),u()},children:"Select"})]})]})]})]})})}delete o.Icon.Default.prototype._getIconUrl,o.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"});export{c as default};
